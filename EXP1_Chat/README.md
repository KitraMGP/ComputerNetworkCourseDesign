# 实验一：简易聊天软件的实现

本程序用 C 语言实现，利用系统提供的 socket API 进行 TCP 通信。本程序实现了所有客户端构成一个群聊进行聊天的功能。

## 运行

启动服务端：

```bash
xmake run Server
```

启动客户端：

```bash
xmake run Client
```

## 原理介绍

本程序使用 pthread 库实现多线程，服务端每传入一个连接，就为其创建一个服务线程。

服务端维护了一个活跃会话列表 session_list，为保证线程安全，使用 pthread_rwlock 来为其加锁。

为了保证每次接收消息能收到完整的消息（而不是被 TCP 拆分或合并），在 packet.c 中封装了自定义的消息收发函数，每条消息开头添加一个消息长度字段，确保每次精确收到一条完整消息。
